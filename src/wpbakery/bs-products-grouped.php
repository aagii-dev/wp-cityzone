<?php

if (!class_exists('vc_odGroupedProducts') && class_exists('WPBakeryShortCode')) {
	class vc_odGroupedProducts extends WPBakeryShortCode
	{
		public function __construct()
		{	
			// ✅ vc_before_init ашиглана!
			add_action('vc_before_init', [$this, 'vc_odGroupedProducts_mapping']);
			// ✅ Shortcode ажиллуулах
			add_shortcode('vc_odGroupedProducts', [$this, 'vc_odGroupedProducts_html']);
		}

		public function vc_odGroupedProducts_mapping()
		{
		

			// Dropdown options бэлтгэх
			$term_options = array('' => '');

			$custocats = get_terms(array(
				'taxonomy'   => 'review_category',
				'hide_empty' => false,
				'orderby'    => 'name',
				'order'      => 'ASC',
			));

			if (!is_wp_error($custocats) && !empty($custocats)) {
				foreach ($custocats as $t) {
					// "Нэр (ID: 123)" -> "123"
					$label = sprintf('%s (ID: %d)', $t->name, $t->term_id);
					$term_options[$label] = (string) $t->term_id;
				}
			}


			vc_map([
				'name' => __('Grouped Products', 'text-domain'),
				'base' => 'vc_odGroupedProducts',
				'category' => __('BurenScore', 'text-domain'),
				'icon' => 'icon-wpb-slideshow',
				'params' => array(
					array(
						'type' => 'textfield',
						'heading' => 'Group 1 Title',
						'param_name' => 'mg_title_1',
						'admin_label' => true,
					),
					array(
						'type' => 'textfield',
						'heading' => 'Group 2 Title',
						'param_name' => 'mg_title_2',
						'admin_label' => true,
					),
					array(
						'type' => 'param_group',
						'value' => '',
						'heading' => 'Group 1',
						'param_name' => 'mg_group1',
						'params' => array(
							array(
								'type' => 'attach_image',
								'value' => '',
								'heading' => 'Image',
								'param_name' => 'mg_image',
							),
							array(
								'type' => 'textfield',
								'heading' => 'Title',
								'param_name' => 'mg_title',
								'admin_label' => true,
							),
							array(
								'type' => 'textfield',
								'heading' => 'Description',
								'param_name' => 'mg_description',
								'admin_label' => true,
							),
							array(
								'type' => 'vc_link',
								'heading' => __('Button', 'my-text-domain'),
								'param_name' => 'mg_text_readmore_url',
							),
							array(
								'type' => 'checkbox',
								'heading' => 'Include rating',
								'param_name' => 'mg_includerating',
								'admin_label' => false,
							),
							array(
								'type' => 'dropdown',
								'heading' => __('Category', 'text-domain'),
								'value' => $term_options,
      							'std' => '', // default утга
								'param_name' => 'mg_review',
								'admin_label' => false,
							),
						)
					),
					array(
						'type' => 'param_group',
						'value' => '',
						'heading' => 'Group 2',
						'param_name' => 'mg_group2',
						'params' => array(
							array(
								'type' => 'attach_image',
								'value' => '',
								'heading' => 'Image',
								'param_name' => 'mg_image',
							),
							array(
								'type' => 'textfield',
								'heading' => 'Title',
								'param_name' => 'mg_title',
								'admin_label' => true,
							),
							array(
								'type' => 'textfield',
								'heading' => 'Description',
								'param_name' => 'mg_description',
								'admin_label' => true,
							),
							array(
								'type' => 'vc_link',
								'heading' => __('Button', 'my-text-domain'),
								'param_name' => 'mg_text_readmore_url',
							),
							array(
								'type' => 'checkbox',
								'heading' => 'Include rating',
								'param_name' => 'mg_includerating',
								'admin_label' => false,
							),
							array(
								'type' => 'dropdown',
								'heading' => __('Category', 'text-domain'),
								'value' => $term_options,
      							'std' => '', // default утга
								'param_name' => 'mg_review',
								'admin_label' => false,
							),
						)
					)
					
				),
			]);
		}

		public function vc_odGroupedProducts_html($atts)
		{
			extract(shortcode_atts([
				'mg_title_1' => '',
				'mg_title_2' => '',
				'mg_group1' => '',
				'mg_group2' => '',
			], $atts));


			$group0_list = "";
			$group1_list = "";
			$group2_list = "";
			$mg_group1 = vc_param_group_parse_atts($atts['mg_group1']);
			$mg_group2 = vc_param_group_parse_atts($atts['mg_group2']);
			foreach ($mg_group1 as $val) {
				$rand = rand(1000,9999);
				$bg_url = wp_get_attachment_image_src($val['mg_image'], 'full')[0];
				$mg_title = $val['mg_title'];
				$mg_description = $val['mg_description'];
				$mg_includerating = $val['mg_includerating'];
				$mg_review = $val['mg_review'];
				$mg_text_readmore_url = $val['mg_text_readmore_url'];
				$mg_text_readmore_url = ($mg_text_readmore_url == '||') ? '' : $mg_text_readmore_url;
				$mg_text_readmore_url = vc_build_link($mg_text_readmore_url);
				$btn_link = $mg_text_readmore_url['url'];
				$btn_title = ($mg_text_readmore_url['title'] == '') ? '' : $mg_text_readmore_url['title'];
				$btn_target = ($mg_text_readmore_url['target'] == '') ? '' : $mg_text_readmore_url['title'];
				$btn_rel = ($mg_text_readmore_url['rel'] == '') ? '' : $mg_text_readmore_url['rel'];

				$btn_html = "";
				if($btn_title && $btn_link){
					$btn_html = "<a href='$btn_link' target='$btn_target' class='btn btn-dark '>
									<span>$btn_title</span>
								</a>";
				}




				if ($mg_includerating == 'true') {
						$reviewArgs = array(
							'numberposts' => -1,
							'post_type' => 'review',
							'tax_query'      => [[
								'taxonomy'         => 'review_category',
								'field'            => 'term_id',
								'terms'            => [$mg_review],
								'include_children' => true,
							]],

						);
						$reviews = get_posts($reviewArgs);

						$total_reviews = 0;   // Нийт бичлэгийн тоо
						$total_rating = 0;    // Нийт үнэлгээний нийлбэр
						$counted_reviews = 0; // Үнэлгээ авсан бичлэгийн тоо
						// Үнэлгээний тоог хадгалах массив
						$rating_counts = array(
							5 => 0,
							4 => 0,
							3 => 0,
							2 => 0,
							1 => 0
						);

						if ($reviews) {
							foreach ($reviews as $review) {
								$rating = get_post_meta($review->ID, 'review_rating', true); // Бичлэгийн үнэлгээг авах

								if (!empty($rating)) {
									$total_rating += intval($rating); // Үнэлгээг нийт үнэлгээнд нэмэх
									$counted_reviews++;               // Үнэлгээтэй бичлэгийн тоо нэмэгдүүлэх
								}

								if ($rating >= 1 && $rating <= 5) {
									$rating_counts[$rating]++; // Үнэлгээний тоог нэмэгдүүлэх
								}

								$total_reviews++; // Нийт бичлэгийн тоо нэмэгдүүлэх
							}

							// Үнэлгээ авсан бичлэгүүдийн дундажийг бодох
							$average_rating = $counted_reviews > 0 ? $total_rating / $counted_reviews : 0;


							
							foreach ($reviews as $review) {
								$comment = get_post_meta($review->ID, 'review_comment', true); // Бичлэгийн үнэлгээг авах
								$date = date_i18n('Y-m-d', get_post_timestamp($review->ID));
								$rating = get_post_meta($review->ID, 'review_rating', true);

								$review_list_html .= "<div class='rating-info-box'>
																									<div class='d-flex justify-content-between'>
																										<div class='label'>
																											<div>$review->post_title</div>
																											<div class=''>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 0 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 1 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 2 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 3 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 4 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																											</div>
																										</div>
																										<div class='label'>$date</div>
																									</div>
																									<div class='space space-32'></div>
																									<div class=''>$comment</div>
																								</div>";
							}


						}


					
						$rating_modal_btn_html = "<button class='rating-btn' data-bs-toggle='modal' data-bs-target='#ratingModal$rand'>
																				<svg width='20' height='21' viewBox='0 0 20 21' fill='none' xmlns='http://www.w3.org/2000/svg'>
																				<path d='M10.5377 1.70274C10.1974 1.54049 9.80202 1.54049 9.46172 1.70274C9.16754 1.843 9.00535 2.08654 8.92355 2.22014C8.83899 2.35825 8.75219 2.53419 8.66759 2.70568L6.87114 6.34509L2.85277 6.93243C2.66361 6.96004 2.46952 6.98837 2.31209 7.02623C2.15979 7.06285 1.8782 7.14206 1.6541 7.37859C1.39486 7.65223 1.27294 8.02824 1.32229 8.40194C1.36495 8.72497 1.54649 8.95434 1.64832 9.07336C1.75359 9.1964 1.89413 9.33323 2.0311 9.46658L4.93759 12.2975L4.25179 16.2961C4.21941 16.4846 4.1862 16.678 4.17342 16.8395C4.16105 16.9957 4.1491 17.2881 4.30468 17.5745C4.48464 17.9058 4.80454 18.1382 5.17526 18.207C5.49577 18.2664 5.77017 18.1646 5.91487 18.1046C6.06449 18.0425 6.23818 17.9511 6.40747 17.862L9.99969 15.9729L13.5919 17.862C13.7612 17.9511 13.9349 18.0425 14.0845 18.1046C14.2292 18.1646 14.5036 18.2664 14.8241 18.207C15.1948 18.1382 15.5147 17.9058 15.6947 17.5745C15.8503 17.2881 15.8383 16.9957 15.826 16.8395C15.8132 16.678 15.78 16.4846 15.7476 16.2961L15.0618 12.2975L17.9683 9.46655C18.1053 9.33321 18.2458 9.19639 18.3511 9.07336C18.4529 8.95434 18.6344 8.72497 18.6771 8.40194C18.7264 8.02824 18.6045 7.65223 18.3453 7.37859C18.1212 7.14206 17.8396 7.06285 17.6873 7.02623C17.5299 6.98837 17.3358 6.96004 17.1466 6.93243L13.1282 6.34509L11.3318 2.70575C11.2472 2.53424 11.1604 2.35826 11.0758 2.22014C10.994 2.08654 10.8318 1.843 10.5377 1.70274Z' fill='#98D84E'/>
																				</svg>
																				$total_rating
																				(" . sizeof($reviews) . " " . pll__('reviewed') . ")
																			</button>";

						$rating_modal_html = "<div class='modal fade' id='ratingModal$rand' tabindex='-1' aria-hidden='true'>
																		<div class='modal-dialog modal-dialog-centered raging-dialog'>
																			<div class='modal-content'>
																				<div class='modal-header '>
																					<div class='text-center w-100'>
																						<span class='review-title'>" . pll__('review_modal_title') . "</span>
																					</div>

																					<div class='modal-closer' data-bs-dismiss='modal' aria-label='Close'>
																						<svg width='18' height='18' viewBox='0 0 18 18' fill='none' xmlns='http://www.w3.org/2000/svg'>
																						<path d='M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5' stroke='#282828' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
																						</svg>
																					</div>	
																				</div>
																				<div class='modal-body '>
																					<form id='reviewForm$rand' class='d-flex flex-column justify-content-center gap32 needs-validation' novalidate>
																						

																						
																						<div class='d-flex justify-content-between mb-24'>
																							<div class='rating-star active'>
																							<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>

																							</div>
																							<div class='rating-star'>
																									<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																									<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																								<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																								<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							
																						</div>
																						<input type='hidden' name='modal' value='ratingModal$rand' />
																						<input type='hidden' name='page' value='$mg_review' />
																						<input type='hidden' name='rating' value='1' />
																						<input type='text' class='form-control ' name='name' placeholder='Өөрийн нэр бичих' required />
																						<textarea class='form-control'name='comment' placeholder='Сэтгэгдэл бичих' rows='6' required></textarea>
																						<button type='submit' class='btn btn-dark mt-24'>" . pll__('send') . "</button>
																					</form>
																				</div>
																				
																			</div>
																		</div>
																	</div>";


						$rating_detail_modal_html = "<div class='modal fade' id='ratingDetailModal$rand' tabindex='-1' aria-hidden='true'>
																		<div class='modal-dialog modal-dialog-centered rating-detail-dialog modal-dialog-scrollable'>
																			<div class='modal-content'>
																				<div class='modal-closer' data-bs-dismiss='modal' aria-label='Close'>
																					<svg width='18' height='18' viewBox='0 0 18 18' fill='none' xmlns='http://www.w3.org/2000/svg'>
																					<path d='M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5' stroke='#282828' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
																					</svg>

																				</div>	
																				<div class='modal-body '>
																					<div class='row'>
																						<div class='col-md-5'>
																							<div class='p-3 sticky-top'>
																								<div class='rating-head d-flex align-items-center gap8 mb-2'>
																									<svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'  class='icon-fill icon-primary'>
																										<path d='M12.6456 1.77566C12.2372 1.58096 11.7628 1.58096 11.3545 1.77566C11.0014 1.94398 10.8068 2.23622 10.7087 2.39654C10.6072 2.56228 10.503 2.77341 10.4015 2.97919L8.24576 7.34648L3.42371 8.05129C3.19672 8.08442 2.96381 8.11841 2.7749 8.16384C2.59214 8.20779 2.25423 8.30284 1.98531 8.58668C1.67422 8.91505 1.52792 9.36626 1.58714 9.8147C1.63833 10.2023 1.85618 10.4776 1.97838 10.6204C2.10469 10.768 2.27334 10.9322 2.43771 11.0923L5.9255 14.4894L5.10254 19.2877C5.06369 19.5139 5.02383 19.746 5.00849 19.9398C4.99365 20.1272 4.97931 20.4781 5.16601 20.8218C5.38196 21.2194 5.76584 21.4983 6.21071 21.5807C6.59531 21.652 6.9246 21.5299 7.09823 21.4579C7.27778 21.3834 7.4862 21.2737 7.68936 21.1668L12 18.8999L16.3107 21.1668C16.5139 21.2737 16.7223 21.3834 16.9018 21.4579C17.0755 21.5299 17.4047 21.652 17.7893 21.5807C18.2342 21.4983 18.6181 21.2194 18.834 20.8218C19.0207 20.4781 19.0064 20.1272 18.9916 19.9398C18.9762 19.746 18.9364 19.5139 18.8975 19.2877L18.0745 14.4894L21.5624 11.0922C21.7267 10.9322 21.8954 10.768 22.0217 10.6204C22.1439 10.4776 22.3617 10.2023 22.4129 9.8147C22.4721 9.36626 22.3258 8.91505 22.0147 8.58668C21.7458 8.30284 21.4079 8.20779 21.2252 8.16384C21.0362 8.11841 20.8033 8.08442 20.5763 8.05129L15.7543 7.34648L13.5986 2.97927C13.4971 2.77347 13.3929 2.56229 13.2914 2.39654C13.1932 2.23622 12.9986 1.94398 12.6456 1.77566Z' />
																									</svg>
																									<span>" . number_format($average_rating, 2) . "</span> 
																									<span>(Нийт $total_reviews үнэлгээ)</span> 
																								</div>
																								$progress_html
																							</div>
																						</div>
																						<div class='col-md-7'>
																							<div class='d-flex gap32 w-100 flex-column'>
																								$review_list_html
																							</div>																				
																						</div>
																					</div>
																				</div>
																				
																			</div>
																		</div>
																	</div>";
					}


				$group1_list .= "<div class='col-md-6 col-lg-4'>
									<div class='product-item2'>
										<a href='$btn_link' target='btn_link' class='product-item2-link'></a>
										<div class='position-relative index-2'>
											<div class='product-item-image'>
												<div class='image-wrapper mb-24' >
													<div class='bg-view' style='background-image: url($bg_url)'></div>
													<div class='aspect-4-3'></div>
												</div>
												<div class='mb-24 product-item2-title'>$mg_title</div>
												<div class='mb-24'>$mg_description</div>
												<div>$btn_html</div>
											</div>
										</div>
										$rating_modal_btn_html
									</div>
								</div>$rating_modal_html";


								
				

				
			}
			foreach ($mg_group2 as $val) {
					$rand = rand(1000,9999);
					$bg_url = wp_get_attachment_image_src($val['mg_image'], 'full')[0];
					$mg_title = $val['mg_title'];
					$mg_description = $val['mg_description'];
					$mg_includerating = $val['mg_includerating'];
					$mg_review = $val['mg_review'];
					$mg_text_readmore_url = $val['mg_text_readmore_url'];
					$mg_text_readmore_url = ($mg_text_readmore_url == '||') ? '' : $mg_text_readmore_url;
					$mg_text_readmore_url = vc_build_link($mg_text_readmore_url);
					$btn_link = $mg_text_readmore_url['url'];
					$btn_title = ($mg_text_readmore_url['title'] == '') ? '' : $mg_text_readmore_url['title'];
					$btn_target = ($mg_text_readmore_url['target'] == '') ? '' : $mg_text_readmore_url['title'];
					$btn_rel = ($mg_text_readmore_url['rel'] == '') ? '' : $mg_text_readmore_url['rel'];

					$btn_html = "";
					if($btn_title && $btn_link){
						$btn_html = "<a href='$btn_link' target='$btn_target' class='btn btn-dark '>
										<span>$btn_title</span>
									</a>";
					}




					if ($mg_includerating == 'true') {
						$reviewArgs = array(
							'numberposts' => -1,
							'post_type' => 'review',
							'tax_query'      => [[
								'taxonomy'         => 'review_category',
								'field'            => 'term_id',
								'terms'            => [$mg_review],
								'include_children' => true,
							]],

						);
						$reviews = get_posts($reviewArgs);

						$total_reviews = 0;   // Нийт бичлэгийн тоо
						$total_rating = 0;    // Нийт үнэлгээний нийлбэр
						$counted_reviews = 0; // Үнэлгээ авсан бичлэгийн тоо
						// Үнэлгээний тоог хадгалах массив
						$rating_counts = array(
							5 => 0,
							4 => 0,
							3 => 0,
							2 => 0,
							1 => 0
						);

						if ($reviews) {
							foreach ($reviews as $review) {
								$rating = get_post_meta($review->ID, 'review_rating', true); // Бичлэгийн үнэлгээг авах

								if (!empty($rating)) {
									$total_rating += intval($rating); // Үнэлгээг нийт үнэлгээнд нэмэх
									$counted_reviews++;               // Үнэлгээтэй бичлэгийн тоо нэмэгдүүлэх
								}

								if ($rating >= 1 && $rating <= 5) {
									$rating_counts[$rating]++; // Үнэлгээний тоог нэмэгдүүлэх
								}

								$total_reviews++; // Нийт бичлэгийн тоо нэмэгдүүлэх
							}

							// Үнэлгээ авсан бичлэгүүдийн дундажийг бодох
							$average_rating = $counted_reviews > 0 ? $total_rating / $counted_reviews : 0;


							
							foreach ($reviews as $review) {
								$comment = get_post_meta($review->ID, 'review_comment', true); // Бичлэгийн үнэлгээг авах
								$date = date_i18n('Y-m-d', get_post_timestamp($review->ID));
								$rating = get_post_meta($review->ID, 'review_rating', true);

								$review_list_html .= "<div class='rating-info-box'>
																									<div class='d-flex justify-content-between'>
																										<div class='label'>
																											<div>$review->post_title</div>
																											<div class=''>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 0 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 1 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 2 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 3 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																												<svg width='20' height='20' viewBox='0 0 20 20' fill='none' class='rating-info-box-star' >
																													<path d='M10.5386 1.4796C10.1983 1.31735 9.803 1.31735 9.4627 1.4796C9.16852 1.61986 9.00633 1.86339 8.92453 1.99699C8.83997 2.13511 8.75317 2.31105 8.66856 2.48254L6.87212 6.12194L2.85374 6.70929C2.66458 6.73689 2.47049 6.76522 2.31306 6.80308C2.16076 6.8397 1.87917 6.91891 1.65508 7.15545C1.39584 7.42908 1.27392 7.8051 1.32327 8.17879C1.36593 8.50182 1.54746 8.73119 1.6493 8.85022C1.75456 8.97325 1.8951 9.11008 2.03207 9.24344L4.93857 12.0744L4.25277 16.0729C4.22039 16.2615 4.18718 16.4549 4.17439 16.6164C4.16203 16.7725 4.15007 17.0649 4.30566 17.3514C4.48562 17.6827 4.80552 17.9151 5.17624 17.9838C5.49675 18.0432 5.77115 17.9415 5.91585 17.8814C6.06547 17.8193 6.23915 17.728 6.40845 17.6389L10.0007 15.7498L13.5929 17.6389C13.7622 17.728 13.9359 17.8193 14.0855 17.8814C14.2302 17.9415 14.5046 18.0432 14.8251 17.9838C15.1958 17.9151 15.5157 17.6827 15.6957 17.3514C15.8513 17.0649 15.8393 16.7725 15.827 16.6164C15.8142 16.4549 15.781 16.2615 15.7486 16.073L15.0628 12.0744L17.9693 9.24341C18.1063 9.11006 18.2468 8.97324 18.352 8.85022C18.4539 8.73119 18.6354 8.50182 18.6781 8.17879C18.7274 7.8051 18.6055 7.42908 18.3463 7.15545C18.1222 6.91891 17.8406 6.8397 17.6883 6.80308C17.5308 6.76522 17.3368 6.73689 17.1476 6.70928L13.1292 6.12194L11.3328 2.4826C11.2482 2.3111 11.1614 2.13512 11.0768 1.99699C10.995 1.86339 10.8328 1.61986 10.5386 1.4796Z' class='" . (intval($rating) > 4 ? 'filled' : 'nonefilled') . "'/>
																												</svg>
																											</div>
																										</div>
																										<div class='label'>$date</div>
																									</div>
																									<div class='space space-32'></div>
																									<div class=''>$comment</div>
																								</div>";
							}


						}


					
						$rating_modal_btn_html = "<button class='rating-btn' data-bs-toggle='modal' data-bs-target='#ratingModal$rand'>
																				<svg width='20' height='21' viewBox='0 0 20 21' fill='none' xmlns='http://www.w3.org/2000/svg'>
																				<path d='M10.5377 1.70274C10.1974 1.54049 9.80202 1.54049 9.46172 1.70274C9.16754 1.843 9.00535 2.08654 8.92355 2.22014C8.83899 2.35825 8.75219 2.53419 8.66759 2.70568L6.87114 6.34509L2.85277 6.93243C2.66361 6.96004 2.46952 6.98837 2.31209 7.02623C2.15979 7.06285 1.8782 7.14206 1.6541 7.37859C1.39486 7.65223 1.27294 8.02824 1.32229 8.40194C1.36495 8.72497 1.54649 8.95434 1.64832 9.07336C1.75359 9.1964 1.89413 9.33323 2.0311 9.46658L4.93759 12.2975L4.25179 16.2961C4.21941 16.4846 4.1862 16.678 4.17342 16.8395C4.16105 16.9957 4.1491 17.2881 4.30468 17.5745C4.48464 17.9058 4.80454 18.1382 5.17526 18.207C5.49577 18.2664 5.77017 18.1646 5.91487 18.1046C6.06449 18.0425 6.23818 17.9511 6.40747 17.862L9.99969 15.9729L13.5919 17.862C13.7612 17.9511 13.9349 18.0425 14.0845 18.1046C14.2292 18.1646 14.5036 18.2664 14.8241 18.207C15.1948 18.1382 15.5147 17.9058 15.6947 17.5745C15.8503 17.2881 15.8383 16.9957 15.826 16.8395C15.8132 16.678 15.78 16.4846 15.7476 16.2961L15.0618 12.2975L17.9683 9.46655C18.1053 9.33321 18.2458 9.19639 18.3511 9.07336C18.4529 8.95434 18.6344 8.72497 18.6771 8.40194C18.7264 8.02824 18.6045 7.65223 18.3453 7.37859C18.1212 7.14206 17.8396 7.06285 17.6873 7.02623C17.5299 6.98837 17.3358 6.96004 17.1466 6.93243L13.1282 6.34509L11.3318 2.70575C11.2472 2.53424 11.1604 2.35826 11.0758 2.22014C10.994 2.08654 10.8318 1.843 10.5377 1.70274Z' fill='#98D84E'/>
																				</svg>
																				$total_rating
																				(" . sizeof($reviews) . " " . pll__('reviewed') . ")
																			</button>";

						$rating_modal_html = "<div class='modal fade' id='ratingModal$rand' tabindex='-1' aria-hidden='true'>
																		<div class='modal-dialog modal-dialog-centered raging-dialog'>
																			<div class='modal-content'>
																				<div class='modal-header '>
																					<div class='text-center w-100'>
																						<span class='review-title'>" . pll__('review_modal_title') . "</span>
																					</div>

																					<div class='modal-closer' data-bs-dismiss='modal' aria-label='Close'>
																						<svg width='18' height='18' viewBox='0 0 18 18' fill='none' xmlns='http://www.w3.org/2000/svg'>
																						<path d='M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5' stroke='#282828' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
																						</svg>
																					</div>	
																				</div>
																				<div class='modal-body '>
																					<form id='reviewForm$rand' class='d-flex flex-column justify-content-center gap32 needs-validation' novalidate>
																						

																						
																						<div class='d-flex justify-content-between mb-24'>
																							<div class='rating-star active'>
																							<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>

																							</div>
																							<div class='rating-star'>
																									<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																									<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																								<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							<div class='rating-star'>
																								<svg width='17' height='16' viewBox='0 0 17 16' fill='none' xmlns='http://www.w3.org/2000/svg'>
																								<path d='M8.06257 1.58993C8.23544 1.23972 8.32187 1.06462 8.43921 1.00867C8.5413 0.959999 8.6599 0.959999 8.76199 1.00867C8.87933 1.06462 8.96576 1.23972 9.13862 1.58993L10.7786 4.9124C10.8297 5.01579 10.8552 5.06748 10.8925 5.10762C10.9255 5.14316 10.9651 5.17195 11.0091 5.1924C11.0588 5.21551 11.1158 5.22384 11.2299 5.24052L14.8983 5.77672C15.2846 5.83318 15.4778 5.86141 15.5672 5.95577C15.6449 6.03786 15.6815 6.15066 15.6667 6.26277C15.6497 6.39162 15.5099 6.52782 15.2302 6.80022L12.5767 9.38475C12.494 9.46532 12.4526 9.5056 12.4259 9.55354C12.4023 9.59597 12.3871 9.6426 12.3813 9.69082C12.3747 9.74528 12.3844 9.80218 12.4039 9.91599L13.0301 13.5665C13.0961 13.9516 13.1291 14.1441 13.0671 14.2583C13.0131 14.3577 12.9171 14.4274 12.8059 14.448C12.6781 14.4717 12.5052 14.3808 12.1594 14.199L8.87987 12.4743C8.77769 12.4206 8.72659 12.3937 8.67277 12.3832C8.62511 12.3738 8.57609 12.3738 8.52843 12.3832C8.4746 12.3937 8.42351 12.4206 8.32133 12.4743L5.04178 14.199C4.69602 14.3808 4.52314 14.4717 4.39531 14.448C4.2841 14.4274 4.18813 14.3577 4.13414 14.2583C4.07209 14.1441 4.1051 13.9516 4.17114 13.5665L4.79725 9.91599C4.81677 9.80218 4.82653 9.74528 4.81993 9.69082C4.81408 9.6426 4.79892 9.59597 4.77529 9.55354C4.7486 9.5056 4.70724 9.46532 4.62453 9.38475L1.97101 6.80022C1.69133 6.52782 1.5515 6.39162 1.53448 6.26277C1.51968 6.15066 1.55625 6.03786 1.63402 5.95577C1.72341 5.86141 1.91656 5.83318 2.30287 5.77672L5.97132 5.24052C6.0854 5.22384 6.14245 5.21551 6.19212 5.1924C6.23611 5.17195 6.27571 5.14316 6.30872 5.10762C6.34602 5.06748 6.37153 5.01579 6.42257 4.9124L8.06257 1.58993Z' stroke='#282828' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/>
																								</svg>
																							</div>
																							
																						</div>
																						<input type='hidden' name='modal' value='ratingModal$rand' />
																						<input type='hidden' name='page' value='$mg_review' />
																						<input type='hidden' name='rating' value='1' />
																						<input type='text' class='form-control ' name='name' placeholder='Өөрийн нэр бичих' required />
																						<textarea class='form-control'name='comment' placeholder='Сэтгэгдэл бичих' rows='6' required></textarea>
																						<button type='submit' class='btn btn-dark mt-24'>" . pll__('send') . "</button>
																					</form>
																				</div>
																				
																			</div>
																		</div>
																	</div>";


						$rating_detail_modal_html = "<div class='modal fade' id='ratingDetailModal$rand' tabindex='-1' aria-hidden='true'>
																		<div class='modal-dialog modal-dialog-centered rating-detail-dialog modal-dialog-scrollable'>
																			<div class='modal-content'>
																				<div class='modal-closer' data-bs-dismiss='modal' aria-label='Close'>
																					<svg width='18' height='18' viewBox='0 0 18 18' fill='none' xmlns='http://www.w3.org/2000/svg'>
																					<path d='M13.5 4.5L4.5 13.5M4.5 4.5L13.5 13.5' stroke='#282828' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>
																					</svg>

																				</div>	
																				<div class='modal-body '>
																					<div class='row'>
																						<div class='col-md-5'>
																							<div class='p-3 sticky-top'>
																								<div class='rating-head d-flex align-items-center gap8 mb-2'>
																									<svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'  class='icon-fill icon-primary'>
																										<path d='M12.6456 1.77566C12.2372 1.58096 11.7628 1.58096 11.3545 1.77566C11.0014 1.94398 10.8068 2.23622 10.7087 2.39654C10.6072 2.56228 10.503 2.77341 10.4015 2.97919L8.24576 7.34648L3.42371 8.05129C3.19672 8.08442 2.96381 8.11841 2.7749 8.16384C2.59214 8.20779 2.25423 8.30284 1.98531 8.58668C1.67422 8.91505 1.52792 9.36626 1.58714 9.8147C1.63833 10.2023 1.85618 10.4776 1.97838 10.6204C2.10469 10.768 2.27334 10.9322 2.43771 11.0923L5.9255 14.4894L5.10254 19.2877C5.06369 19.5139 5.02383 19.746 5.00849 19.9398C4.99365 20.1272 4.97931 20.4781 5.16601 20.8218C5.38196 21.2194 5.76584 21.4983 6.21071 21.5807C6.59531 21.652 6.9246 21.5299 7.09823 21.4579C7.27778 21.3834 7.4862 21.2737 7.68936 21.1668L12 18.8999L16.3107 21.1668C16.5139 21.2737 16.7223 21.3834 16.9018 21.4579C17.0755 21.5299 17.4047 21.652 17.7893 21.5807C18.2342 21.4983 18.6181 21.2194 18.834 20.8218C19.0207 20.4781 19.0064 20.1272 18.9916 19.9398C18.9762 19.746 18.9364 19.5139 18.8975 19.2877L18.0745 14.4894L21.5624 11.0922C21.7267 10.9322 21.8954 10.768 22.0217 10.6204C22.1439 10.4776 22.3617 10.2023 22.4129 9.8147C22.4721 9.36626 22.3258 8.91505 22.0147 8.58668C21.7458 8.30284 21.4079 8.20779 21.2252 8.16384C21.0362 8.11841 20.8033 8.08442 20.5763 8.05129L15.7543 7.34648L13.5986 2.97927C13.4971 2.77347 13.3929 2.56229 13.2914 2.39654C13.1932 2.23622 12.9986 1.94398 12.6456 1.77566Z' />
																									</svg>
																									<span>" . number_format($average_rating, 2) . "</span> 
																									<span>(Нийт $total_reviews үнэлгээ)</span> 
																								</div>
																								$progress_html
																							</div>
																						</div>
																						<div class='col-md-7'>
																							<div class='d-flex gap32 w-100 flex-column'>
																								$review_list_html
																							</div>																				
																						</div>
																					</div>
																				</div>
																				
																			</div>
																		</div>
																	</div>";
					}



		
					$group2_list .= "<div class='col-md-6 col-lg-4'>
										<div class='product-item2'>
											<a href='$btn_link' target='btn_link' class='product-item2-link'></a>
											<div class='position-relative index-2'>
												<div class='product-item-image'>
													<div class='image-wrapper mb-24' >
														<div class='bg-view' style='background-image: url($bg_url)'></div>
														<div class='aspect-4-3'></div>
													</div>
													<div class='mb-24 product-item2-title'>$mg_title</div>
													<div class='mb-24'>$mg_description</div>
													<div>$btn_html</div>
												</div>
											</div>
											$rating_modal_btn_html
										</div>
									</div>$rating_modal_html";
					
				}
				$group0_list = $group1_list ."". $group2_list;
			


			return "<div class='section bg-silver section-d64' >
						
					 	<div class='container mt-32'>
							<div class='text-center'>
								<ul class='nav nav-tabs' id='myTab' role='tablist'>
									<li class='nav-item' role='presentation'>
										<button class='nav-link active' id='group0-tab' data-bs-toggle='tab' data-bs-target='#group0'
										type='button' role='tab' aria-controls='group0' aria-selected='true'>
										Бүгд
										</button>
									</li>
									<li class='nav-item' role='presentation'>
										<button class='nav-link' id='group1-tab' data-bs-toggle='tab' data-bs-target='#group1'
										type='button' role='tab' aria-controls='group1' aria-selected='false'>
										$mg_title_1
										</button>
									</li>
									<li class='nav-item' role='presentation'>
										<button class='nav-link' id='group2-tab' data-bs-toggle='tab' data-bs-target='#group2'
										type='button' role='tab' aria-controls='group2' aria-selected='false'>
										$mg_title_2
										</button>
									</li>
									
								</ul>
							</div>

							<!-- Tab Content -->
							<div class='tab-content mt-64' >
								<div class='tab-pane fade show active' id='group0' role='tabpanel' aria-labelledby='group0-tab'>
									<div class='row'>
										$group0_list
									</div>
								</div>
								<div class='tab-pane fade' id='group1' role='tabpanel' aria-labelledby='group1-tab'>
									<div class='row'>
										$group1_list
									</div>
								</div>
								<div class='tab-pane fade' id='group2' role='tabpanel' aria-labelledby='group2-tab'>
									<div class='row'>
										$group2_list
									</div>
								</div>
							</div>


						</div>
					</div>";
		}
	}
	new vc_odGroupedProducts();
}
